---
phase: 4
plan: 2
wave: 1
---

# Plan 4.2: Admin Stats API

## Objective
Implement a secure API endpoint to fetch aggregated user data and prediction history for the admin dashboard.

## Context
- .gsd/SPEC.md
- backend/main.py
- backend/database.py

## Tasks

<task type="auto">
  <name>Implement Stats API Endpoint</name>
  <files>backend/main.py</files>
  <action>
    Add `GET /api/admin/stats` to `backend/main.py`:
    - It should require an `email` in the query params (for now, simple auth) to check if `is_admin == 1`.
    - Returns:
      - Total user count.
      - Recent predictions (last 10).
      - Counts of predictions per type (Heart, Diabetes, etc.).
    - Ensure it returns 403 Forbidden if the user is not an admin.
  </action>
  <verify>Call the endpoint with an admin email and a regular user email to verify authorization.</verify>
  <done>Backend serves statistics securely to admin users.</done>
</task>

<task type="auto">
  <name>Update Login Response</name>
  <files>backend/main.py</files>
  <action>
    Update the `login` endpoint in `backend/main.py` to include the `is_admin` flag in the returned user object.
  </action>
  <verify>Log in with the admin account and verify that the response contains `"is_admin": true` (or 1).</verify>
  <done>Frontend receives admin status upon successful login.</done>
</task>

## Success Criteria
- [ ] API successfully returns user and prediction statistics.
- [ ] Non-admin users are blocked from fetching stats.
- [ ] User role is transferred to frontend during login.
