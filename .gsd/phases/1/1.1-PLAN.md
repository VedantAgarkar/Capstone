---
phase: 1
plan: 1
wave: 1
---

# Plan 1.1: Database Schema & Connection

## Objective
Set up a persistent SQLite database to store user credentials and establish a secure connection utility that uses parameterized queries by design.

## Context
- .gsd/SPEC.md
- backend/main.py
- backend/data/ (target directory for the DB file)

## Tasks

<task type="auto">
  <name>Create Database Utility</name>
  <files>backend/database.py</files>
  <action>
    Create `backend/database.py` with the following:
    - `get_db_connection()` function returning a sqlite3 connection.
    - `init_db()` function to create a `users` table if it doesn't exist.
    - Table columns: `id` (INTEGER PRIMARY KEY), `email` (TEXT UNIQUE), `password` (TEXT), `fullname` (TEXT).
    - Ensure all code uses `?` placeholders for SQL.
  </action>
  <verify>Run a script to check if `backend/data/users.db` is created and table exists.</verify>
  <done>File created and `users` table exists in `backend/data/users.db`.</done>
</task>

<task type="auto">
  <name>Initialize Database on Startup</name>
  <files>backend/main.py</files>
  <action>
    Update `backend/main.py` to:
    - Import `init_db` from `backend.database`.
    - Call `init_db()` within the FastAPI `startup` event.
  </action>
  <verify>Start the FastAPI server and check logs/filesystem for DB initialization.</verify>
  <done>Server starts without error and DB is initialized.</done>
</task>

## Success Criteria
- [ ] `backend/database.py` exists with secure connection logic.
- [ ] `backend/data/users.db` is automatically created on startup.
- [ ] `users` table has the correct schema.
