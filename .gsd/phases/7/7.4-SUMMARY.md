# Summary â€” Plan 7.4: Robust Identity Tracking & Bot Logging

## What Was Done
Fixed the core issue where registered users appeared as "Guest User" in the admin dashboard and expanded tracking to the Medical Bot.

### Improvements Made
- **Robust Identity Propagation**:
  - **`backend/utils.py`**: Updated `get_email()` to use safe dictionary-style access for `st.query_params`, ensuring it picks up the `email` from the URL correctly in newer Streamlit versions.
  - **`backend/database.py`**: Modified `log_prediction` to be case-insensitive by using `LOWER(email)` and `strip().lower()` on inputs. Added debug logs to help identify user resolution issues.
  - **`backend/main.py`**: Added email normalization (lowercase) during registration and login to ensure database consistency.
- **Unified Activity Tracking**:
  - **`backend/routes/bot.py`**: Integrated `log_prediction` into the Medical ChatBot. Every user query is now logged as an interaction, allowing administrators to see what users are asking the AI.

## Verification
- Registered users will now have their `fullname` correctly resolved in the dashboard activity log because email matching is now case-insensitive and parameter reading is more robust.
- Bot interactions now appear in the dashboard alongside health assessments.
- Guest users still fallback to "Guest User" as intended.
