---
phase: 1
plan: 2
wave: 2
---

# Plan 1.2: Register & Login Logic (Parameterized)

## Objective
Implement the backend authentication endpoints using parameterized SQL queries to ensure zero vulnerability to SQL injection.

## Context
- .gsd/SPEC.md
- backend/database.py
- backend/main.py

## Tasks

<task type="auto">
  <name>Implement API Endpoints</name>
  <files>backend/main.py</files>
  <action>
    Add the following endpoints to `backend/main.py`:
    - `POST /api/register`: Accepts `email`, `password`, `fullname`. Inserts into `users` table using `INSERT INTO users (...) VALUES (?, ?, ?)`.
    - `POST /api/login`: Accepts `email`, `password`. Queries using `SELECT * FROM users WHERE email = ? AND password = ?`.
    - Use simple password comparison for now (or basic hashing if specified). 
    - Ensure errors are handled and return appropriate HTTP status codes (400 for existing user, 401 for bad credentials).
  </action>
  <verify>Use `curl` or a test script to register a user and then login.</verify>
  <done>Endpoints are responsive and work with valid data.</done>
</task>

<task type="auto">
  <name>Verify SQL Injection Protection</name>
  <files>backend/main.py</files>
  <action>
    Test the login endpoint with a classic SQLi payload:
    - Email: `admin@example.com' OR '1'='1`
    - Password: `any`
    - Ensure the query fails to find a user or errors safely, rather than logging in.
  </action>
  <verify>Run a curl command with the SQLi payload and verify it returns 401 Unauthorized.</verify>
  <done>SQL injection attempts fail.</done>
</task>

## Success Criteria
- [ ] `/api/register` successfully stores users.
- [ ] `/api/login` validates credentials correctly.
- [ ] SQL injection payloads in the login form are neutralized by parameterized queries.
