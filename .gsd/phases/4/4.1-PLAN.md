---
phase: 4
plan: 1
wave: 1
---

# Plan 4.1: Schema Update & Admin Creation

## Objective
Update the SQLite database to support administrative roles and data tracking for prediction history.

## Context
- .gsd/SPEC.md
- backend/database.py
- backend/main.py

## Tasks

<task type="auto">
  <name>Update Database Schema</name>
  <files>backend/database.py</files>
  <action>
    Modify `init_db` in `backend/database.py`:
    - Add `is_admin` INTEGER DEFAULT 0 to the `users` table.
    - Create a `predictions` table:
      - `id` INTEGER PRIMARY KEY AUTOINCREMENT
      - `user_id` INTEGER (Foreign Key to users.id)
      - `type` TEXT (e.g., 'heart', 'diabetes')
      - `inputs` TEXT (JSON string of input values)
      - `outcome` TEXT (Prediction result)
      - `timestamp` DATETIME DEFAULT CURRENT_TIMESTAMP
  </action>
  <verify>Run `python backend/database.py` and check the schema using a SQLite viewer or command line.</verify>
  <done>Database supports admin roles and prediction logging.</done>
</task>

<task type="auto">
  <name>Promote Admin User</name>
  <files>scripts/create_admin.py</files>
  <action>
    Create a script `scripts/create_admin.py` that:
    - Connects to the database.
    - Updates a user (by email) to have `is_admin = 1`.
    - Or creates a default admin account if none exists (e.g., admin@healthpredict.com).
  </action>
  <verify>Run the script and verify the `is_admin` flag in the `users` table.</verify>
  <done>At least one admin account exists for testing.</done>
</task>

## Success Criteria
- [ ] `users` table has `is_admin` column.
- [ ] `predictions` table is created.
- [ ] An admin account is successfully flagged in the database.
