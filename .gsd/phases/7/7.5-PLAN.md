# Plan 7.5: Fix Marathi PDF Rendering

## Objective
Address the premature word wrapping in Marathi PDF reports that leads to excessive page counts (e.g., 34 pages). We will transition from the `write()` method to `multi_cell()` for better paragraph handling and refine the line splitting logic.

## Context
- `backend/utils.py`: The `generate_pdf_report` function.

## Tasks

<task type="auto">
  <name>Refactor PDF Report Generation Logic</name>
  <files>
    - backend/utils.py
  </files>
  <action>
    - Modify the `generate_pdf_report` function in `utils.py`.
    - Change the text output inside the `has_unicode_font` block from `pdf.write(6, clean_line)` + `pdf.ln(6)` to `pdf.multi_cell(0, 7, clean_line)`. This ensures proper paragraph-level wrapping handled by the library.
    - Add a check to remove consecutive empty lines from the `content` before processing, preventing unnecessary vertical space.
    - Ensure headers (`###` and `##`) use `multi_cell` as well for consistent alignment.
    - Check if `fpdf2` is actually being used and use its modern alignment features if possible.
  </action>
  <verify>Check that white-space stripping and multi_cell are implemented.</verify>
  <done>PDF report generation uses multi_cell for all text blocks, providing robust wrapping.</done>
</task>

<task type="auto">
  <name>Improve Font Loading Robustness</name>
  <files>
    - backend/utils.py
  </files>
  <action>
    - Enhance the font loading logic to try multiple common Devanagari fonts (e.g., Mangal, Nirmala, Kokila) before falling back to the ASCII-only Arial.
    - Update the fallback path to also use `multi_cell` for consistency.
  </action>
  <verify>Verify multiple font paths are attempted.</verify>
  <done>PDF generator is more likely to find a suitable Unicode font on a Windows system.</done>
</task>

## Success Criteria
- [ ] Marathi PDF reports wrap naturally at Page Margins.
- [ ] Total page count for a standard assessment is reasonable (1-2 pages).
- [ ] No more "2 words per line" behavior.
